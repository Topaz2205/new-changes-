{% extends "base.html" %}
{% block title %}מוצרים{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 m-0">מוצרים</h1>
  <a class="btn btn-primary" href="{{ url_for('product_routes.add_product_form') }}">+ הוסף מוצר</a>
</div>

<table id="productsTable" class="table table-striped table-hover table-bordered align-middle js-datatable table-st">
  <thead>
    <tr>
      <th>#</th>
      <th class="col-thumb">תמונה</th>
      <th>שם</th>
      <th>קטגוריה</th>
      <th>ספק</th>
      <th>צבע</th>
      <th class="text-end">מחיר</th>
      <th class="text-end">מלאי</th>
      <th class="text-nowrap">פעולות</th>
    </tr>
  </thead>
  <tbody>
    {% for p in products %}
      <tr>
        <td>{{ p.id }}</td>

        <td class="col-thumb">
          {% if p.image_url %}
            <img class="prod-thumb"
                 src="{{ p.image_url }}"
                 alt="תמונה - {{ p.name }}"
                 loading="lazy"
                 data-image-preview="{{ p.image_url }}">
          {% else %}
            <div class="prod-thumb-fallback">אין תמונה</div>
          {% endif %}
        </td>

        <td>{{ p.name }}</td>
        <td>{{ p.category_name }}</td>
        <td>{{ p.supplier_name }}</td>

        <td>
          {% if p.color_hex %}
            <span class="d-inline-block rounded-circle border"
                  style="width:14px;height:14px;background-color: {{ p.color_hex }};"
                  title="{{ p.color_name }}"></span>
            <span class="ms-1">{{ p.color_name }}</span>
          {% else %}
            <span class="text-muted">—</span>
          {% endif %}
        </td>

        <td class="text-end">
          {% if p.unit_price is not none %}{{ "%.2f"|format(p.unit_price) }}{% else %}—{% endif %}
        </td>
        <td class="text-end">{{ p.units_in_stock }}</td>

        <td class="text-nowrap table-actions">
          <a class="btn btn-sm btn-outline-secondary"
             href="{{ url_for('product_routes.edit_product_form', id=p.id) }}">עריכה</a>

          <form method="post"
                action="{{ url_for('product_routes.delete_product', id=p.id) }}"
                style="display:inline"
                onsubmit="return confirm('למחוק מוצר?');">
            <button type="submit" class="btn btn-sm btn-outline-danger">מחיקה</button>
          </form>

          <button class="btn btn-sm btn-info"
                  hx-get="{{ url_for('product_routes.add_stock_partial', product_id=p.id) }}"
                  hx-target="#genericModal .modal-body"
                  hx-trigger="click"
                  data-bs-toggle="modal" data-bs-target="#genericModal">
            הוסף מלאי
          </button>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
