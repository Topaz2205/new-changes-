{% extends "base.html" %}
{% block title %}מוצרים{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 m-0">מוצרים</h1>
  <a class="btn btn-primary" href="{{ url_for('product_routes.add_product_form') }}">+ הוסף מוצר</a>
</div>

<table id="productsTable" class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>שם</th>
      <th>קטגוריה</th>
      <th>ספק</th>
      <th>מחיר</th>
      <th>מלאי</th>
      <th class="text-nowrap">פעולות</th>
    </tr>
  </thead>
  <tbody>
    {% for p in products %}
      <tr>
        <td>{{ p.id }}</td>
        <td>{{ p.name }}</td>
        <td>{{ p.category_name }}</td>
        <td>{{ p.supplier_name }}</td>
        <td>{{ "%.2f"|format(p.unit_price) }}</td>
        <td>{{ p.units_in_stock }}</td>
        <td class="text-nowrap table-actions">
            <a class="btn btn-sm btn-outline-secondary"
                href="{{ url_for('product_routes.edit_product_form', product_id=p.id) }}">עריכה</a>

            <form method="post"
                    action="{{ url_for('product_routes.delete_product', id=p.id) }}"
                    style="display:inline"
                    onsubmit="return confirm('למחוק מוצר?');">
                <button type="submit" class="btn btn-sm btn-outline-danger">מחיקה</button>
            </form>

            <button class="btn btn-sm btn-outline-primary"
                    hx-get="{{ url_for('product_routes.add_stock_partial', product_id=p.id) }}"
                    hx-target="#modalBody"
                    data-bs-toggle="modal" data-bs-target="#genericModal">
                הוסף מלאי
            </button>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block extra_js %}
<script>
  // DataTables = חיפוש/מיון/דפדוף אוטומטיים
  $(function() {
    $('#productsTable').DataTable({
      pageLength: 10,
      order: [[0, 'asc']]
    });
  });
</script>
{% endblock %}
